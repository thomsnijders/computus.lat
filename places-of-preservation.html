<!DOCTYPE html>
<html>
<head>

    <title>Computus manuscripts and where to find them</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
	
	<link rel="stylesheet" type="text/css" href="https://computus.lat/css/reset.css">
    <link rel="stylesheet" type="text/css" href="https://computus.lat/css/style.css">
    <link rel="stylesheet" type="text/css" href="https://computus.lat/css/template.min.css?v=1.1">
	
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/esri-leaflet/dist/esri-leaflet.js"></script>
    <script src="https://unpkg.com/esri-leaflet-vector@3/dist/esri-leaflet-vector.js"></script>

    <style>
        body {
            margin: 0;
        }
        #basemaps-wrapper {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 400;
            background: white;
            padding: 10px;
        }
        #basemaps {
            margin-bottom: 5px;
        }
    </style>

</head>
<body data-template="maps">

<div id="map" style="width: 100vw; height: 100vh;"></div>



<script>

    var map = L.map("map").setView([ 50,4.579], 5);
	
	L.esri.Vector.vectorBasemapLayer("ArcGIS:Topographic", {
		"apikey": "AAPK7cbfb9d0e1f3424eab34001fc3928216FnnnCT0hXWLeJD9SVMwARnRCbUStKfgwOUlKEJ9X1LLEEa205uB2MrxAHt5F68OB"	
	}).addTo(map);

    var layerLabels;

	L.Control.Heading = L.Control.extend({
        onAdd: function(map) {
            var container = L.DomUtil.create('div', 'map-header leaflet-bar leaflet-control leaflet-control-custom');
            var heading = L.DomUtil.create('h1');

            heading.append("Computus manuscripts and where to find them");
            container.append(heading);
            return container;
        }
    });

    L.control.header = function(opts) {
        return new L.Control.Heading(opts);
    };

    var hdr = L.control.header({ position: 'topleft' }).addTo(map);
    map.zoomControl.setPosition('bottomright');
		
	var LocationsOfPreservation = L.layerGroup();
			
	var color = [];
    color.push("9D9D9D", "00E18B", "00DD47", "00D904", "3BD500", "79D200", "B5CE00", "CAA600", "C66700", "C22B00", "BF000E");

			
	function colors(val) {
		if(val == 0){
			return "#" + color[0];
		}

		if(val == 1){
			return "#"+ color[3];
		}

		if(val > 1 && val <= 5){
			return "#" + color[5];
		}

		if(val > 5 && val <= 25){
			return "#" + color[7];
		}

		if(val > 25 && val <= 50){
			return "#" + color[8];
		}

		if(val > 50 && val <= 75){
			return "#" + color[9];
		}

		if(val > 75){
			return "#" + color[10];
		}
	}
	

	$.getJSON("json/places-of-preservation.json", function( data ) {
		$.each(data.LocationsOfPreservation, function(index, LocationOfPreservation) {
			if(LocationOfPreservation.lat !== null && LocationOfPreservation.lng !== null) {
			marker = new L.circleMarker([LocationOfPreservation.lat,LocationOfPreservation.lng], {
				color: colors(LocationOfPreservation.MSCount),
				fillColor: colors(LocationOfPreservation.MSCount),
				fillOpacity: 0.5,
				radius: 5
			}).bindPopup("<strong>" + LocationOfPreservation.Location + " " + LocationOfPreservation.Institution + "</strong><br>" + LocationOfPreservation.MSCount + " computistical manuscripts<br><br>");
			marker.addTo(LocationsOfPreservation);
			}
		});

		LocationsOfPreservation.addTo(map);
		
		var PlacesOfOrigin = L.layerGroup();
		
		$.each(data.PlacesOfOrigin, function(index, PlaceOfOrigin) {
			if(PlaceOfOrigin.lat !== null && PlaceOfOrigin.lng !== null) {
			marker = new L.circleMarker([PlaceOfOrigin.lat,PlaceOfOrigin.lng], {
				color: colors(PlaceOfOrigin.MSCount),
				fillColor: colors(PlaceOfOrigin.MSCount),
				fillOpacity: 0.5,
				radius: 5
			}).bindPopup("<strong>" + PlaceOfOrigin.Label + "</strong><br>" + PlaceOfOrigin.MSCount + " computistical manuscripts<br><br>" + "<a href='//computus.lat/origin/" + PlaceOfOrigin.MetaID + "' target='_blank'>Browse</a>")

			marker.addTo(PlacesOfOrigin);
			}
		});

		var overlayMaps = {
			"Libraries of preservation": LocationsOfPreservation,
			"Places of origin": PlacesOfOrigin
		};

		L.control.layers(null, overlayMaps).addTo(map);
	});
			
	

</script>

</body>
</html>
